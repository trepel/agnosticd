---
- name: Login kerberos
  command: >-
    kinit {{ kerberos_user }}
  args:
    stdin: "{{ kerberos_password }}"

- name: Add NS records to IPA
  command: >-
    ipa dnsrecord-add {{ ipa_domain }}. {{ account_name }} --ns-rec={{ _z }}.
  loop: "{{ ns_records }}"
  loop_control:
    loop_var: _z
  register: _ipacommand
  failed_when:
    - _ipacommand.rc != 0
    - '"ERROR: no modifications to be performed" not in _ipacommand.stderr'
  changed_when: >-
    "ERROR: no modifications to be performed"
    not in _ipacommand.stderr
